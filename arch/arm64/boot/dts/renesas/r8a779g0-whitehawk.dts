// SPDX-License-Identifier: GPL-2.0
/*
 * Device Tree Source for the White Hawk CPU boards with R-Car V4H
 *
 * Copyright (C) 2021 Renesas Electronics Corp.
 */

/dts-v1/;
#include "r8a779g0-whitehawk-cpu.dtsi"
#include <dt-bindings/media/r8a779g0-csi2.h>

/ {
	model = "Renesas White Hawk CPU boards based on r8a779g0";
	compatible = "renesas,whitehawk-cpu", "renesas,r8a779g0";

	aliases {
		ethernet0 = &avb0;
	};

	reserved-memory {
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;

		vdsp0_region: linux,vdsp0_region@5d000000 {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x00000000 0x5d000000 0x0 0x00800000>;
		};

		vdsp1_region: linux,vdsp1_region@5d800000 {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x00000000 0x5d800000 0x0 0x00800000>;
		};

		vdsp2_region: linux,vdsp2_region@5e000000 {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x00000000 0x5e000000 0x0 0x00800000>;
		};

		vdsp3_region: linux,vdsp3_region@5e800000 {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x00000000 0x5e800000 0x0 0x00800000>;
		};

		pap_region: linux,pap_region@5f000000 {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x00000000 0x5f000000 0x0 0x00400000>;
		};

		/* region for cr core application */
		cr_region: linux,cr_region@60000000 {
			no-map;
			reg = <0x00000000 0x60000000 0x0 0x20000000>;
		};

		/* global autoconfigured region for contiguous allocations */
		linux,cma@80000000 {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x00000000 0x80000000 0x0 0x23000000>;
			linux,cma-default;
		};
	};

	dsi-con0 {
		compatible = "dsi-connector";

		port {
			dsi_con_out0: endpoint {
				remote-endpoint = <&sn65dsi86_out0>;
			};
		};
	};

	dsi-con1 {
		compatible = "dsi-connector";

		port {
			dsi_con_out1: endpoint {
				remote-endpoint = <&sn65dsi86_out1>;
			};
		};
	};

	cmem {
		memory-region = <&vdsp0_region>, <&vdsp1_region>,
				<&vdsp2_region>, <&vdsp3_region>,
				<&pap_region>;
	};
};

&avb0 {
	pinctrl-0 = <&avb0_pins>, <&vddq_eth_pins>;
	pinctrl-names = "default";
	phy-handle = <&phy0>;
	tx-internal-delay-ps = <2000>;
	status = "okay";

	phy0: ethernet-phy@0 {
		compatible = "ethernet-phy-id0022.1622",
			     "ethernet-phy-ieee802.3-c22";
		rxc-skew-ps = <1500>;
		reg = <0>;
		interrupt-parent = <&gpio7>;
		interrupts = <5 IRQ_TYPE_LEVEL_LOW>;
		reset-gpios = <&gpio7 10 GPIO_ACTIVE_LOW>;
	};
};

&avb1 {
	pinctrl-0 = <&avb1_pins>, <&vddq_eth_pins>;
	pinctrl-names = "default";
	phy-handle = <&phy1>;
	status = "okay";
	phy-reset-gpios = <&gpio6 1 GPIO_ACTIVE_LOW>;

	phy1: ethernet-phy@1 {
		compatible = "ethernet-phy-ieee802.3-c45";
		reg = <0>;
		interrupt-parent = <&gpio6>;
		interrupts = <3 IRQ_TYPE_LEVEL_LOW>;
		reset-gpios = <&gpio6 1 GPIO_ACTIVE_LOW>;
	};
};

&avb2 {
	pinctrl-0 = <&avb2_pins>, <&vddq_eth_pins>;
	pinctrl-names = "default";
	phy-handle = <&phy2>;
	status = "okay";
	phy-reset-gpios = <&gpio5 5 GPIO_ACTIVE_LOW>;

	phy2: ethernet-phy@2 {
		compatible = "ethernet-phy-ieee802.3-c45";
		reg = <0>;
		interrupt-parent = <&gpio5>;
		interrupts = <4 IRQ_TYPE_LEVEL_LOW>;
		reset-gpios = <&gpio5 5 GPIO_ACTIVE_LOW>;
	};
};

&tsn0 {
	pinctrl-0 = <&tsn0_pins>, <&vddq_eth_pins>;
	pinctrl-names = "default";
	phy-handle = <&phy3>;
	tx-internal-delay;
	status = "okay";

	phy3: ethernet-phy@3 {
		compatible = "ethernet-phy-ieee802.3-c45";
		reg = <0>;
		interrupt-parent = <&gpio4>;
		interrupts = <3 IRQ_TYPE_LEVEL_LOW>;
		reset-gpios = <&gpio1 23 GPIO_ACTIVE_LOW>;
	};
};

&canfd {
	pinctrl-0 = <&canfd0_pins>, <&canfd1_pins>, <&canfd2_pins>,
		<&canfd3_pins>, <&canfd4_pins>, <&canfd5_pins>,
		<&canfd6_pins>, <&canfd7_pins>;
		pinctrl-names = "default";
	status = "okay";

	channel0 {
		status = "okay";
	};

	channel1 {
		status = "okay";
	};

	channel2 {
		status = "okay";
	};

	channel3 {
		status = "okay";
	};

	channel4 {
		status = "okay";
	};

	channel5 {
		status = "okay";
	};

	channel6 {
		status = "okay";
	};

	channel7 {
		status = "okay";
	};
};

&gpio6 {
	avb1_avtp_match {
		gpio-hog;
		gpios = <5 GPIO_ACTIVE_HIGH>;
		output-high;
		line-name = "AVB1_AVTP_MAGIC";
	};

	avb1_avtp_pps {
		gpio-hog;
		gpios = <10 GPIO_ACTIVE_HIGH>;
		output-high;
		line-name = "AVB1_AVTP_PPS";
	};

	avb1_avtp_capture {
		gpio-hog;
		gpios = <11 GPIO_ACTIVE_HIGH>;
		output-high;
		line-name = "AVB1_AVTP_CAPTURE";
	};
};

&gpio5 {
	avb2_avtp_match {
		gpio-hog;
		gpios = <2 GPIO_ACTIVE_HIGH>;
		output-high;
		line-name = "AVB2_AVTP_MAGIC";
	};

	avb2_avtp_pps {
		gpio-hog;
		gpios = <0 GPIO_ACTIVE_HIGH>;
		output-high;
		line-name = "AVB2_AVTP_PPS";
	};

	avb2_avtp_capture {
		gpio-hog;
		gpios = <1 GPIO_ACTIVE_HIGH>;
		output-high;
		line-name = "AVB2_AVTP_CAPTURE";
	};
};

&pfc {
	vddq_eth_pins: vddq_eth {
		pins_pwr {
			pins = "GP_4_0", "GP_5_0", "GP_6_0","GP_7_0";
			power-source = <3300>;
		};
	};

	avb0_pins: avb0 {
		mux {
			groups = "avb0_link", "avb0_mdio", "avb0_rgmii",
				 "avb0_txcrefclk";
			function = "avb0";
		};

		pins_mdio {
			groups = "avb0_mdio";
			drive-strength = <21>;
		};

		pins_mii {
			groups = "avb0_rgmii";
			drive-strength = <21>;
		};

	};

	avb1_pins: avb1 {
		mux {
			groups = "avb1_link", "avb1_mdio", "avb1_rgmii",
			"avb1_txcrefclk";
			function = "avb1";
		};

		pins_mdio {
			groups = "avb1_mdio";
			drive-strength = <24>;
		};

		pins_mii_tx {
			pins = "GP_6_7", "GP_6_6",
				"GP_6_13", "GP_6_12",
				"GP_6_16", "GP_6_18";
			drive-strength = <24>;
		};

		pin_tx_ctl {
			pins = "GP_6_7";
			bias-pull-up;
		};

		pins_puen_disable {
			pins = "GP_6_0", "GP_6_1", "GP_6_2", "GP_6_3", "GP_6_4",
			"GP_6_5", "GP_6_6", "GP_6_8", "GP_6_9", "GP_6_10",
			"GP_6_11", "GP_6_12", "GP_6_13", "GP_6_14", "GP_6_15",
			"GP_6_16", "GP_6_17", "GP_6_18", "GP_6_19", "GP_6_20";
			bias-disable;
		};
	};

	avb2_pins: avb2 {
		mux {
			groups = "avb2_link", "avb2_mdio", "avb2_rgmii",
				"avb2_txcrefclk";
			function = "avb2";
		};

		pins_mdio {
			groups = "avb2_mdio";
			drive-strength = <24>;
		};

		pin_tx_ctl {
			pins = "GP_5_19";
			bias-pull-up;
		};

		pins_puen_disable {
			pins = "GP_5_0", "GP_5_1", "GP_5_2", "GP_5_3", "GP_5_4",
				"GP_5_5", "GP_5_6", "GP_5_7", "GP_5_8", "GP_5_9", "GP_5_10",
				"GP_5_11", "GP_5_12", "GP_5_13", "GP_5_14", "GP_5_15",
				"GP_5_16", "GP_5_17", "GP_5_18", "GP_5_20";
			bias-disable;
		};
	};

	tsn0_pins: tsn0 {
		mux {
			groups = "tsn0_link", "tsn0_mdio", "tsn0_rgmii",
				 "tsn0_txcrefclk";
			function = "tsn0";
		};

		pins_mdio {
			groups = "tsn0_mdio";
			drive-strength = <21>;
		};

		pins_mii {
			groups = "tsn0_rgmii";
			drive-strength = <21>;
		};

	};

	i2c1_pins: i2c1 {
		groups = "i2c1";
		function = "i2c1";
	};

	i2c4_pins: i2c4 {
		groups = "i2c4";
		function = "i2c4";
	};

	canfd0_pins: canfd0 {
		groups = "canfd0_data";
		function = "canfd0";
	};

	canfd1_pins: canfd1 {
		groups = "canfd1_data";
		function = "canfd1";
	};

	canfd2_pins: canfd2 {
		groups = "canfd2_data";
		function = "canfd2";
	};

	canfd3_pins: canfd3 {
		groups = "canfd3_data";
		function = "canfd3";
	};

	canfd4_pins: canfd4 {
		groups = "canfd4_data";
		function = "canfd4";
	};

	canfd5_pins: canfd5 {
		groups = "canfd5_data";
		function = "canfd5";
	};

	canfd6_pins: canfd6 {
		groups = "canfd6_data";
		function = "canfd6";
	};

	canfd7_pins: canfd7 {
		groups = "canfd7_data";
		function = "canfd7";
	};

};

&cmt0 {
	status = "okay";
};

&cmt1 {
	status = "okay";
};

&cmt2 {
	status = "okay";
};

&cmt3 {
	status = "okay";
};

&tmu0 {
	status = "okay";
};

&tmu1 {
	status = "okay";
};

&tmu2 {
	status = "okay";
};

&tmu3 {
	status = "okay";
};

&tmu4 {
	status = "okay";
};

&rwdt {
	timeout-sec = <60>;
	status = "okay";
};

&i2c0 {
	io_expander2: gpio@21 {
		compatible = "onnn,pca9654";
		reg = <0x21>;
		gpio-controller;
		#gpio-cells = <2>;
	};

	io_expander3: gpio@22 {
		compatible = "onnn,pca9654";
		reg = <0x22>;
		gpio-controller;
		#gpio-cells = <2>;
	};

	io_expander4: gpio@27 {
		compatible = "onnn,pca9654";
		reg = <0x27>;
		gpio-controller;
		#gpio-cells = <2>;
	};
};

&i2c1 {
	pinctrl-0 = <&i2c1_pins>;
	pinctrl-names = "default";

	status = "okay";
	clock-frequency = <400000>;

	sn65dsi86_0@2c {
		compatible = "ti,sn65dsi86";
		reg = <0x2c>;
		dp-connector;
		clocks = <&ref_clk>;
		clock-names = "refclk";
		no-use-gpio;
		no-use-scramble;
		hpd-poll;
		status = "okay";

		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			port@0 {
				reg = <0>;
				sn65dsi86_in0: endpoint {
					remote-endpoint = <&dsi0_out>;
				};
			};

			port@1 {
				reg = <1>;
				sn65dsi86_out0: endpoint {
					remote-endpoint = <&dsi_con_out0>;
				};
			};
		};
	};

	max96789@60 {
		compatible = "maxim,max96789";
		reg = <0x60>, <0x0A>, <0x0B>;
		enable-gpios = <&io_expander4 0 GPIO_ACTIVE_HIGH>;
		status = "okay";
		
		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			port@0 {
				reg = <0>;
				max96789_in: endpoint {
					bus-type = <1>;
					clock-lanes = <0>;
					data-lanes = <1 2 3 4>;
					remote-endpoint = <&dsi0_out>;
				};
			};

			port@1 {
				reg = <1>;
				max96789_out: endpoint {
					remote-endpoint = <&vc0113_con>;
				};
			};
		};
	};

	vc0113@55 {
		compatible = "dummy,panel";
		reg = <0x55>;
		status = "okay";
		port {
			vc0113_con: endpoint {
				remote-endpoint = <&max96789_out>;
			};
		};
	};
			
	gmsl0: gmsl-deserializer@49 {
		gpio-controller;
		#gpio-cells = <2>;

		compatible = "maxim,max96712";
		reg = <0x49>, <0x01>, <0x02>, <0x03>, <0x04>;
		gpios = <&io_expander2 0 GPIO_ACTIVE_HIGH>;

		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			port@0 {
				reg = <0>;
				max96712_in0: endpoint {
				};
			};

			port@1 {
				reg = <1>;
				max96712_in1: endpoint {
				};
			};

			port@2 {
				reg = <2>;
				max96712_in2: endpoint {
				};
			};

			port@3 {
				reg = <3>;
				max96712_in3: endpoint {
				};
			};

			port@4 {
				reg = <4>;
				max96712_out0: endpoint {
					bus-type = <1>;
					clock-lanes = <0>;
					data-lanes = <1 2 3>;
					remote-endpoint = <&csi40_in>;
				};
			};
		};

		i2c-mux {
			#address-cells = <1>;
			#size-cells = <0>;

			i2c@0 {
				#address-cells = <1>;
				#size-cells = <0>;
				reg = <0>;

				status = "disabled";
			};

			i2c@1 {
				#address-cells = <1>;
				#size-cells = <0>;
				reg = <1>;

				status = "disabled";
			};

			i2c@2 {
				#address-cells = <1>;
				#size-cells = <0>;
				reg = <2>;

				status = "disabled";
			};

			i2c@3 {
				#address-cells = <1>;
				#size-cells = <0>;
				reg = <3>;

				status = "disabled";
			};
		};
	};

	gmsl1: gmsl-deserializer@4b {
		gpio-controller;
		#gpio-cells = <2>;

		compatible = "maxim,max96712";
		reg = <0x4b>, <0x05>, <0x06>, <0x07>, <0x08>;
		gpios = <&io_expander3 0 GPIO_ACTIVE_HIGH>;
		//maxim,invert_phy-pol;	// for D-PHY

		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			port@0 {
				reg = <0>;
				max96712_in4: endpoint {
				};
			};

			port@1 {
				reg = <1>;
				max96712_in5: endpoint {
				};
			};

			port@2 {
				reg = <2>;
				max96712_in6: endpoint {
				};
			};

			port@3 {
				reg = <3>;
				max96712_in7: endpoint {
				};
			};

			port@4 {
				reg = <4>;
				max96712_out1: endpoint {
					bus-type = <1>;
					clock-lanes = <0>;
					data-lanes = <1 2 3>;
					remote-endpoint = <&csi41_in>;
				};
			};
		};

		i2c-mux {
			#address-cells = <1>;
			#size-cells = <0>;

			i2c@0 {
				#address-cells = <1>;
				#size-cells = <0>;
				reg = <0>;

				status = "disabled";
			};

			i2c@1 {
				#address-cells = <1>;
				#size-cells = <0>;
				reg = <1>;

				status = "disabled";
			};

			i2c@2 {
				#address-cells = <1>;
				#size-cells = <0>;
				reg = <2>;

				status = "disabled";
			};

			i2c@3 {
				#address-cells = <1>;
				#size-cells = <0>;
				reg = <3>;

				status = "disabled";
			};
		};
	};
};

&i2c4 {
	pinctrl-0 = <&i2c4_pins>;
	pinctrl-names = "default";

	status = "okay";
	clock-frequency = <400000>;

	sn65dsi86_1@2c {
		compatible = "ti,sn65dsi86";
		reg = <0x2c>;
		dp-connector;
		clocks = <&ref_clk>;
		clock-names = "refclk";
		no-use-gpio;
		no-use-scramble;
		hpd-poll;
		status = "disabled";

		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			port@0 {
				reg = <0>;
				sn65dsi86_in1: endpoint {
					remote-endpoint = <&dsi1_out>;
				};
			};

			port@1 {
				reg = <1>;
				sn65dsi86_out1: endpoint {
					remote-endpoint = <&dsi_con_out1>;
				};
			};
		};
	};
};

&pcie_bus_clk {
	clock-frequency = <100000000>;
};

&du {
	status = "okay";
};

&dsi0 {
	status = "okay";

	use-extal-clk;

	ports {
		port@1 {
			endpoint {
				remote-endpoint = <&sn65dsi86_in0>;
				//remote-endpoint = <&max96789_in>;
				data-lanes = <1 2 3 4>;
			};
		};
	};
};

&dsc {
	status = "disabled";
};

&dsi1 {
	status = "disabled";

	use-extal-clk;

	ports {
		port@1 {
			endpoint {
				remote-endpoint = <&sn65dsi86_in1>;
				data-lanes = <1 2 3 4>;
			};
		};
	};
};

&ref_clk {
	clock-frequency = <38400000>;
};

&csi40 {
	status = "okay";
	pin-swap;

	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			reg = <0>;

			csi40_in: endpoint {
				bus-type = <1>;
				clock-lanes = <0>;
				data-lanes = <1 2 3>;
				pin-swap-rx-order = <ABC BCA ABC>;
				hs-receive-eq = <0x4 0x4 0x4>;
				remote-endpoint = <&max96712_out0>;
			};
		};
	};
};

&csi41 {
	status = "okay";
	pin-swap;

	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			reg = <0>;

			csi41_in: endpoint {
				bus-type = <1>;
				clock-lanes = <0>;
				data-lanes = <1 2 3>;
				pin-swap-rx-order = <ABC BCA ABC>;
				hs-receive-eq = <0x4 0x4 0x4>;
				remote-endpoint = <&max96712_out1>;
			};
		};
	};
};

&vin00 {
	status = "okay";
};

&vin01 {
	status = "okay";
};

&vin02 {
	status = "okay";
};

&vin03 {
	status = "okay";
};

&vin10 {
	status = "okay";
};

&vin11 {
	status = "okay";
};

&vin12 {
	status = "okay";
};

&vin13 {
	status = "okay";
};
/* FAKRA Overlay */
#include "whitehawk-fakra.dtsi"
